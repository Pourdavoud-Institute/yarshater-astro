---
/* ----------------------------------------------------------------------------
 * Share Links
 * Interactive component using Alpine.js to enable sharing and copying the page
 * URL from the `window.navigator` interface. First checks browser support
 * before displaying and uses conditional styles to show action messages.
 * ----------------------------------------------------------------------------
 */

interface Props {
    title: string;
}

const { title } = Astro.props;
---

<div
    class="share-links | flow"
    data-pagefind-ignore="all"
    data-tempo="vivace"
    id="share"
    x-data=`{
        title: '${title}',
        webShareSupported: false,
        webShareMessage: '',
        clipboardSupported: false,
        clipboardMessage: '',
        init() {
            if (window.navigator.share != undefined) {
                this.webShareSupported = true;
            }
            if (window.navigator.clipboard != undefined) {
                this.clipboardSupported = true;
            }
        },
        handleShare() {
            if (this.webShareSupported) {
                const url = window.location.href;
                window.navigator.share({ title: this.title, url }).then(() => {
                    console.log('sharing', url);
                    this.webShareMessage = 'Link shared!';
                    setTimeout(() => {
                        this.webShareMessage = '';
                    }, 3000);
                }).catch((err) => console.error('Error sharing', err));
            }
        },
        handleCopy() {
            if (this.clipboardSupported) {
                const url = window.location.href;
                window.navigator.clipboard.writeText(url).then(() => {
                    console.log('copying', url);
                    this.clipboardMessage = 'Link copied!';
                    setTimeout(() => {
                        this.clipboardMessage = '';
                    }, 3000);
                }).catch((err) => console.error('Error copying', err));
            }
        }
    }`
>
    <div class="small-title">Share This Page</div>
    <div class="buttons | cluster">
        <div class="relative" x-show="webShareSupported">
            <button
                class="button-link with-icon"
                data-style="primary-ghost"
                type="button"
                x-on:click="handleShare"
            >
                <svg
                    aria-hidden="true"
                    class="ucla-icon__link-external"
                    height="24"
                    viewBox="0 0 24 24"
                    width="24"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        d="M19 19H5V5H12V3H5C3.89 3 3 3.9 3 5V19C3 20.1 3.89 21 5 21H19C20.1 21 21 20.1 21 19V12H19V19ZM14 3V5H17.59L7.76 14.83L9.17 16.24L19 6.41V10H21V3H14Z"
                    ></path>
                </svg>
                <span>Share</span>
            </button>
            <p
                aria-live="polite"
                class="context-alert"
                role="alert"
                x-bind:style="!webShareMessage && { display: 'none' }"
                x-text="webShareMessage"
            >
            </p>
        </div>
        <div class="relative" x-show="clipboardSupported">
            <button
                class="button-link with-icon"
                data-style="primary-ghost"
                type="button"
                x-on:click="handleCopy"
            >
                <svg
                    aria-hidden="true"
                    class="ucla-icon__copy"
                    height="24"
                    viewBox="0 0 24 24"
                    width="24"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        d="M16.5 1H4.5C3.4 1 2.5 1.9 2.5 3V17H4.5V3H16.5V1ZM19.5 5H8.5C7.4 5 6.5 5.9 6.5 7V21C6.5 22.1 7.4 23 8.5 23H19.5C20.6 23 21.5 22.1 21.5 21V7C21.5 5.9 20.6 5 19.5 5ZM19.5 21H8.5V7H19.5V21Z"
                    ></path>
                </svg>
                <span>Copy Link</span>
            </button>
            <p
                aria-live="polite"
                class="context-alert"
                role="alert"
                x-bind:style="!clipboardMessage && { display: 'none' }"
                x-text="clipboardMessage"
            >
            </p>
        </div>
    </div>
</div>
